{"version":3,"sources":["./src/app/features/home/photo/photo-routing.module.ts","./src/app/features/home/photo/photo.module.ts","./src/app/features/home/photo/photo.page.ts","./src/app/features/home/photo/photo.page.html"],"names":[],"mappings":"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","file":"4-es2015.8a43048b53d6a37ed645.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { PhotoPage } from './photo.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PhotoPage,\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class PhotoPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { NgxIonicImageViewerModule } from 'ngx-ionic-image-viewer';\nimport { SharedModule } from '../../../shared/shared.module';\nimport { PhotoPageRoutingModule } from './photo-routing.module';\nimport { PhotoPage } from './photo.page';\n\n@NgModule({\n  imports: [SharedModule, PhotoPageRoutingModule, NgxIonicImageViewerModule],\n  declarations: [PhotoPage],\n})\nexport class PhotoPageModule {}\n","import { HttpClient } from '@angular/common/http';\nimport { Component, ViewChild } from '@angular/core';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { IonSlides } from '@ionic/angular';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { FeatureCollection } from 'geojson';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { distinctUntilChanged, map, switchMap } from 'rxjs/operators';\nimport { LanguagesService } from '../../../shared/languages/languages.service';\nimport { Moment } from '../../../shared/moment/moment';\nimport { MomentRepository } from '../../../shared/moment/moment-repository.service';\nimport { isNonNullable } from '../../../utils/rx-operators';\n\n@UntilDestroy()\n@Component({\n  selector: 'app-photo',\n  templateUrl: './photo.page.html',\n  styleUrls: ['./photo.page.scss'],\n})\nexport class PhotoPage {\n  private readonly _ionSlides$ = new BehaviorSubject<undefined | IonSlides>(\n    undefined\n  );\n\n  @ViewChild('slides') set ionSlides(value: IonSlides) {\n    this._ionSlides$.next(value);\n  }\n\n  private readonly ionSlides$ = this._ionSlides$.pipe(\n    isNonNullable(),\n    distinctUntilChanged()\n  );\n\n  private readonly currentMemontId$ = this.route.queryParamMap.pipe(\n    map(params => params.get('id')),\n    isNonNullable(),\n    distinctUntilChanged()\n  );\n\n  readonly moments$ = this.momentRepository.all$;\n\n  private readonly currentMomentIndex$ = combineLatest([\n    this.moments$,\n    this.currentMemontId$,\n  ]).pipe(\n    map(([moments, id]) => moments.findIndex(j => j.id === id)),\n    distinctUntilChanged()\n  );\n\n  readonly currentMoment$ = combineLatest([\n    this.moments$,\n    this.currentMomentIndex$,\n  ]).pipe(map(([moments, currentIndex]) => moments[currentIndex]));\n\n  private readonly geolocationPosition$ = this.currentMoment$.pipe(\n    map(moment => moment.geolocationPosition),\n    isNonNullable()\n  );\n\n  readonly address$ = combineLatest([\n    this.geolocationPosition$,\n    this.languagesService.language$,\n  ]).pipe(\n    switchMap(([position, language]) =>\n      this.httpClient.get<FeatureCollection>(\n        `https://nominatim.openstreetmap.org/reverse?lat=${position.latitude}&lon=${position.longitude}&format=geojson&accept-language=${language}`\n      )\n    ),\n    map(json => {\n      if (json.features.length === 0) return undefined;\n      const properties = json.features[0].properties;\n      if (!properties) return undefined;\n      return properties['display_name'] as string | undefined;\n    })\n  );\n\n  readonly mapUrl$ = this.geolocationPosition$.pipe(\n    map(position =>\n      this.sanitizer.bypassSecurityTrustResourceUrl(\n        `https://maps.google.com/maps?q=${position.latitude},${position.longitude}&z=15&output=embed`\n      )\n    ),\n    isNonNullable()\n  );\n\n  readonly photoSlidesOptions$ = this.currentMomentIndex$.pipe(\n    map(initialIndex => ({\n      resistanceRatio: 0,\n      initialSlide: initialIndex,\n    }))\n  );\n\n  private readonly slideToMoment$ = combineLatest([\n    this.ionSlides$,\n    this.currentMomentIndex$,\n  ]).pipe(switchMap(([slides, index]) => slides.slideTo(index)));\n\n  constructor(\n    private readonly momentRepository: MomentRepository,\n    private readonly route: ActivatedRoute,\n    private readonly router: Router,\n    private readonly sanitizer: DomSanitizer,\n    private readonly httpClient: HttpClient,\n    private readonly languagesService: LanguagesService\n  ) {\n    this.slideToMoment$.pipe(untilDestroyed(this)).subscribe();\n  }\n\n  trackMoment(_: number, item: Moment) {\n    return item.id;\n  }\n\n  onPhotoSlidesChanged(event: Event) {\n    const ionSlides = event.target as HTMLIonSlidesElement;\n    return this.moments$\n      .pipe(\n        switchMap(\n          async moments => moments[await ionSlides.getActiveIndex()].id\n        ),\n        switchMap(id =>\n          this.router.navigate([], {\n            queryParams: { id },\n            relativeTo: this.route,\n            replaceUrl: true,\n          })\n        ),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n}\n","<ion-header class=\"ion-no-border\">\n  <ion-toolbar>\n    <ion-buttons slot=\"start\">\n      <ion-back-button color=\"light\"></ion-back-button>\n    </ion-buttons>\n    <ion-buttons slot=\"end\">\n      <ion-button slot=\"primary\" color=\"light\">\n        <ion-icon name=\"trash-outline\" slot=\"icon-only\"></ion-icon>\n      </ion-button>\n      <ion-button slot=\"secondary\" color=\"light\">\n        <ion-icon name=\"share-social-outline\" slot=\"icon-only\"></ion-icon>\n      </ion-button>\n    </ion-buttons>\n  </ion-toolbar>\n</ion-header>\n<ion-content fullscreen *transloco=\"let t\">\n  <ion-slides\n    #slides\n    *ngrxLet=\"photoSlidesOptions$ as options\"\n    [options]=\"options\"\n    (ionSlideDidChange)=\"onPhotoSlidesChanged($event)\"\n  >\n    <ion-slide *ngFor=\"let moment of moments$ | ngrxPush; trackBy: trackMoment\">\n      <app-image\n        *ngrxLet=\"moment.photoUrl$ as photoUrl\"\n        ionImgViewer\n        [src]=\"photoUrl\"\n      ></app-image>\n\n      <ion-list lines=\"none\">\n        <ion-item>\n          <ion-label>\n            {{\n              moment.timestamp\n                | translocoDate: { dateStyle: 'full', timeStyle: 'full' }\n            }}\n          </ion-label>\n        </ion-item>\n        <ion-item-group *ngIf=\"moment.geolocationPosition\">\n          <ion-item-divider>\n            <ion-label>{{ t('location') }}</ion-label>\n          </ion-item-divider>\n          <iframe\n            *ngrxLet=\"mapUrl$ as mapUrl\"\n            [src]=\"mapUrl\"\n            frameborder=\"0\"\n            loading=\"lazy\"\n          ></iframe>\n          <ion-item>\n            <ion-icon name=\"location-outline\" slot=\"start\"></ion-icon>\n            <ion-label>\n              <h3>{{ t('coordinates') }}</h3>\n              <p>\n                {{ moment.geolocationPosition?.latitude }}\n                ,\n                {{ moment.geolocationPosition?.longitude }}\n              </p>\n            </ion-label>\n          </ion-item>\n          <ion-item>\n            <ion-icon name=\"home-outline\" slot=\"start\"></ion-icon>\n            <ion-label>\n              <h3>{{ t('address') }}</h3>\n              <p>{{ address$ | ngrxPush }}</p>\n            </ion-label>\n          </ion-item>\n        </ion-item-group>\n\n        <ion-item-group>\n          <ion-item-divider>\n            <ion-label>{{ t('details') }}</ion-label>\n          </ion-item-divider>\n          <ion-item>\n            <ion-icon name=\"code-outline\" slot=\"start\"></ion-icon>\n            <ion-label>\n              <h3>{{ t('hash') }}</h3>\n              <p>{{ moment.id }}</p>\n            </ion-label>\n          </ion-item>\n          <ion-item>\n            <ion-icon name=\"document-outline\" slot=\"start\"></ion-icon>\n            <ion-label>\n              <h3>{{ t('mimeType') }}</h3>\n              <p>{{ moment.mimeType }}</p>\n            </ion-label>\n          </ion-item>\n        </ion-item-group>\n      </ion-list>\n    </ion-slide>\n  </ion-slides>\n</ion-content>\n"],"sourceRoot":"webpack:///"}