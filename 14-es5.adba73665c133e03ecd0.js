!function(){function e(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var c,a=e[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var r,n=o(e);if(t){var c=o(this).constructor;r=Reflect.construct(n,arguments,c)}else r=n.apply(this,arguments);return i(this,r)}}function i(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{QDOj:function(t,i,o){"use strict";o.r(i),o.d(i,"CameraPageModule",function(){return re});var a,s,f=o("PCNd"),l=o("tyNb"),p=o("mrSG"),b=o("VfN6"),d=o("2Vo4"),v=o("/uUt"),h=o("bOdf"),m=o("JIr8"),g=o("KJy6"),O=o("fXoL"),j=o("TEn/"),y=o("QPBi"),w=((a=function(){function e(t,r){c(this,e),this.alertController=t,this.translocoService=r}return u(e,[{key:"presentAlert",value:function(e){var t=e.headerKey,r=e.messageKey;return Object(p.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.translocoService.translate(t),i=this.translocoService.translate(r),console.log(n,i),e.next=4,this.alertController.create({header:n,message:i,buttons:[{text:this.translocoService.translate("ok")}]});case 4:return o=e.sent,e.next=7,o.present();case 7:case"end":return e.stop()}},e,this)}))}},{key:"presentError",value:function(e){return Object(p.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.error(e),t.next=3,this.alertController.create({header:this.translocoService.translate("error.".concat(e instanceof Error?e.name:"UnknownError")),message:e instanceof Error?e.message:JSON.stringify(e),buttons:[{text:this.translocoService.translate("ok")}]});case 3:return r=t.sent,t.next=6,r.present();case 6:case"end":return t.stop()}},t,this)}))}}]),e}()).\u0275fac=function(e){return new(e||a)(O.Zb(j.a),O.Zb(y.e))},a.\u0275prov=O.Mb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),x=o("BJdS"),k=o("r0o6"),$=o("NXyV"),S=o("jtHE"),C=o("lJxs"),P=o("UXun"),R=o("vkgz"),E=o("CqXF"),_=o("SxV6"),I=o("eIep"),M=o("q7zd"),U=o("JX91"),V=o("7o/Q"),D=function(){function e(){c(this,e)}return u(e,[{key:"call",value:function(e,t){return t.subscribe(new z(e))}}]),e}(),z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(i,e);var t=n(i);function i(e){var r;return c(this,i),(r=t.call(this,e)).hasPrev=!1,r}return u(i,[{key:"_next",value:function(e){var t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}]),i}(V.a),A=((s=function(){function t(){c(this,t),this.videoStreamSelector=new L,this.videoDevices$=this.videoStreamSelector.devices$,this.mediaStream$=this.videoStreamSelector.stream$,this.imageCapture$=this.mediaStream$.pipe(Object(C.a)(function(e){return e.getVideoTracks()[0]}),Object(g.c)(),Object(C.a)(function(e){return new ImageCapture(e)}),Object(P.a)({bufferSize:1,refCount:!0})),this._capturedImageUrl$=new d.a(void 0),this.capturedImageUrl$=this._capturedImageUrl$.pipe(Object(g.c)(),Object(v.a)(),function(t){return t.pipe(Object(U.a)(void 0),function(e){return e.lift(new D)},Object(R.a)(function(t){var r=e(t,1)[0];r&&URL.revokeObjectURL(r)}),Object(M.a)(t))})}return u(t,[{key:"connectPreview$",value:function(e){return this.mediaStream$.pipe(Object(R.a)(function(t){return e.srcObject=t}),Object(E.a)(e))}},{key:"capture$",value:function(){var e=this;return this.imageCapture$.pipe(Object(_.a)(),Object(I.a)(function(e){return e.takePhoto()}),Object(R.a)(function(t){e._capturedImageUrl$.next(URL.createObjectURL(t))}),Object(m.a)(function(t){return Object(p.a)(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof DOMException&&("InvalidStateError"===t.name||"UnknownError"===t.name||"OperationError"===t.name)){e.next=2;break}throw t;case 2:case"end":return e.stop()}},e)}))}),Object(g.c)())}},{key:"nextCamera$",value:function(e){var t=this;return this.videoDevices$.pipe(Object(_.a)(),Object(h.a)(function(r){return Object(k.a)(function(){return r.length>1},Object($.a)(function(){return Object(p.a)(t,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.srcObject=null);case 1:case"end":return t.stop()}},t)}))}).pipe(Object(M.a)(t.videoStreamSelector.next$())))}))}}]),t}()).\u0275fac=function(e){return new(e||s)},s.\u0275prov=O.Mb({token:s,factory:s.\u0275fac,providedIn:"root"}),s),L=function(){function e(){var t=this;c(this,e),this.devices$=Object($.a)(function(){return navigator.mediaDevices.enumerateDevices()}).pipe(Object(C.a)(function(e){return e.filter(function(e){return"videoinput"===e.kind})}),Object(P.a)({bufferSize:1,refCount:!0})),this.currentVideoDeviceIndex=0,this._stream$=new S.a(1),this.stream$=this.devices$.pipe(Object(_.a)(),Object(h.a)(function(e){return t.getCurrentVideoMedia(e)}),Object(R.a)(function(e){return t._stream$.next(e)}),Object(M.a)(this._stream$),Object(P.a)({bufferSize:1,refCount:!0}),Object(g.c)(),Object(g.b)(function(e){return function(e){return e.getVideoTracks().forEach(function(e){return e.stop()}),e}(e)}),Object(P.a)({bufferSize:1,refCount:!0}))}return u(e,[{key:"next$",value:function(){var e=this;return this.stream$.pipe(Object(_.a)(),Object(R.a)(function(e){return e.getVideoTracks().forEach(function(e){return e.stop()})}),Object(M.a)(this.devices$),Object(R.a)(function(){return e.currentVideoDeviceIndex++}),Object(h.a)(function(t){return e.getCurrentVideoMedia(t)}),Object(R.a)(function(t){return e._stream$.next(t)}))}},{key:"getCurrentVideoMedia",value:function(e){return Object(p.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",navigator.mediaDevices.getUserMedia({video:{deviceId:e[this.currentVideoDeviceIndex%e.length].deviceId}}));case 1:case"end":return t.stop()}},t,this)}))}}]),e}(),T=o("zXXW"),F=o("ofXK"),J=o("9A8T"),N=o("/T4s"),X=["video"];function K(e,t){if(1&e){var r=O.Wb();O.Vb(0,"ion-button",9),O.dc("click",function(){return O.qc(r),O.fc(2).reverseCamera()}),O.Rb(1,"ion-icon",10),O.Ub()}}var Q=function(e){return["/image-viewer",e]};function q(e,t){if(1&e&&(O.Vb(0,"div",11),O.Rb(1,"app-image",12),O.Ub()),2&e){var r=t.ngrxLet;O.Fb(1),O.lc("routerLink",O.nc(2,Q,r))("src",r)}}function B(e,t){if(1&e){var r=O.Wb();O.Tb(0),O.Vb(1,"ion-button",3),O.dc("click",function(){return O.qc(r),O.fc().capture()}),O.Rb(2,"ion-icon",4),O.Ub(),O.xc(3,K,2,0,"ion-button",5),O.gc(4,"ngrxPush"),O.xc(5,q,2,4,"div",6),O.Rb(6,"video",7,8),O.Sb()}if(2&e){var n,i=O.fc();O.Fb(3),O.lc("ngIf",(null==(n=O.hc(4,2,i.videoDevices$))?null:n.length)>1),O.Fb(2),O.lc("ngrxLet",i.capturedImageUrl$)}}function W(e,t){if(1&e&&(O.Vb(0,"div",15),O.Rb(1,"ion-img",16),O.Vb(2,"h3"),O.zc(3),O.Ub(),O.Vb(4,"p"),O.zc(5),O.Ub(),O.Ub()),2&e){var r=t.$implicit;O.Fb(3),O.Ac(r("noCameraFound")),O.Fb(2),O.Ac(r("message.noCameraFound"))}}function H(e,t){1&e&&(O.Vb(0,"div",13),O.xc(1,W,6,2,"div",14),O.Ub())}var Z,G,Y,ee=[{path:"",component:(Z=function(){function e(t,r,n){c(this,e),this.dialogsService=t,this.momentRepository=r,this.cameraService=n,this.videoDevices$=this.cameraService.videoDevices$,this._videoElement$=new d.a(void 0),this.videoElement$=this._videoElement$.pipe(Object(g.c)(),Object(v.a)()),this.capturedImageUrl$=this.cameraService.capturedImageUrl$,this.startPreview()}return u(e,[{key:"videoElement",set:function(e){e&&this._videoElement$.next(e.nativeElement)}},{key:"startPreview",value:function(){var e=this;return this.videoElement$.pipe(Object(h.a)(function(t){return e.cameraService.connectPreview$(t)}),Object(m.a)(function(t){return Object(p.a)(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.presentError(t));case 1:case"end":return e.stop()}},e,this)}))}),Object(b.b)(this)).subscribe()}},{key:"capture",value:function(){var e=this;this.cameraService.capture$().pipe(Object(g.a)(function(t){return e.momentRepository.add$(t)}),Object(m.a)(function(t){return Object(p.a)(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.presentError(t));case 1:case"end":return e.stop()}},e,this)}))}),Object(b.b)(this)).subscribe()}},{key:"reverseCamera",value:function(){var e=this;return this.videoElement$.pipe(Object(h.a)(function(t){return e.cameraService.nextCamera$(t)}),Object(m.a)(function(t){return Object(p.a)(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.presentError(t));case 1:case"end":return e.stop()}},e,this)}))}),Object(b.b)(this)).subscribe()}},{key:"presentError",value:function(e){return Object(p.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e instanceof DOMException&&"NotAllowedError"===e.name?this.dialogsService.presentAlert({headerKey:"error.".concat(e.name),messageKey:"message.cameraPermissionDenied"}):this.dialogsService.presentError(e));case 1:case"end":return t.stop()}},t,this)}))}}]),e}(),Z.\u0275fac=function(e){return new(e||Z)(O.Qb(w),O.Qb(x.a),O.Qb(A))},Z.\u0275cmp=O.Kb({type:Z,selectors:[["app-camera"]],viewQuery:function(e,t){var r;1&e&&O.Ec(X,1),2&e&&O.oc(r=O.ec())&&(t.videoElement=r.first)},decls:5,vars:5,consts:[["color","light","fill","clear",1,"dismiss",3,"standalone"],[4,"ngIf","ngIfElse"],["noCamera",""],["fill","clear",1,"capture",3,"click"],["slot","icon-only","name","radio-button-on-outline","color","light"],["class","capture","class","reverse-camera","fill","clear",3,"click",4,"ngIf"],["class","captured ion-margin",4,"ngrxLet"],["playsinline","","autoplay",""],["video",""],["fill","clear",1,"reverse-camera",3,"click"],["slot","icon-only","name","camera-reverse-outline","color","light"],[1,"captured","ion-margin"],[3,"routerLink","src"],[1,"no-camera"],["class","no-camera-illustration",4,"transloco"],[1,"no-camera-illustration"],["src","./assets/icons/undraw-void.svg"]],template:function(e,t){if(1&e&&(O.Rb(0,"app-back-button",0),O.xc(1,B,8,4,"ng-container",1),O.gc(2,"ngrxPush"),O.xc(3,H,2,0,"ng-template",null,2,O.yc)),2&e){var r,n=O.pc(4);O.lc("standalone",!0),O.Fb(1),O.lc("ngIf",0!==(null==(r=O.hc(2,3,t.videoDevices$))?null:r.length))("ngIfElse",n)}},directives:[T.a,F.l,j.d,j.n,J.a,N.a,j.H,l.i,y.c,j.o],pipes:[J.b],styles:["[_nghost-%COMP%]{background:var(--ion-color-dark)}video[_ngcontent-%COMP%]{width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center}.dismiss[_ngcontent-%COMP%]{position:absolute;left:0;z-index:1}ion-button.capture[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%);z-index:1;height:72px;width:72px;margin:0 0 var(--ion-margin,16px);--border-radius:50%;--padding-end:0;--padding-start:0;--background:rgba(0,0,0,0.4)}ion-button.capture[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px}ion-button.reverse-camera[_ngcontent-%COMP%]{position:absolute;bottom:16px;left:16px;z-index:1;height:48px;width:48px;--border-radius:50%;--padding-end:0;--padding-start:0;--background:rgba(0,0,0,0.4)}.captured[_ngcontent-%COMP%]{position:absolute;bottom:16px;right:16px;overflow:hidden;border-radius:4px;border:1px solid var(--ion-color-light-shade)}.captured[_ngcontent-%COMP%]   app-image[_ngcontent-%COMP%]{z-index:1;width:60px;height:60px}.no-camera[_ngcontent-%COMP%]{width:100%;height:100%;background:var(--ion-color-light-shade)}.no-camera-illustration[_ngcontent-%COMP%]{width:70%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}.no-camera-illustration[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{margin:auto;max-width:400px}.no-camera-illustration[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{white-space:pre-line}"]}),Z=Object(p.b)([Object(b.a)()],Z))}],te=((Y=function e(){c(this,e)}).\u0275fac=function(e){return new(e||Y)},Y.\u0275mod=O.Ob({type:Y}),Y.\u0275inj=O.Nb({imports:[[l.j.forChild(ee)],l.j]}),Y),re=((G=function e(){c(this,e)}).\u0275fac=function(e){return new(e||G)},G.\u0275mod=O.Ob({type:G}),G.\u0275inj=O.Nb({imports:[[f.a,te]]}),G)}}])}();