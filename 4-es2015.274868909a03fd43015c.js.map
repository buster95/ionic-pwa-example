{"version":3,"sources":["./src/app/features/home/camera/camera.page.ts","./src/app/features/home/camera/camera.page.html","./src/app/shared/camera/camera.service.ts","./src/app/shared/dialogs/dialogs.service.ts","./src/app/features/home/camera/camera.module.ts","./src/app/features/home/camera/camera-routing.module.ts"],"names":[],"mappings":"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","file":"4-es2015.274868909a03fd43015c.js","sourcesContent":["import { Component, ElementRef, ViewChild } from '@angular/core';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { BehaviorSubject } from 'rxjs';\nimport { catchError, concatMap, distinctUntilChanged } from 'rxjs/operators';\nimport { CameraService } from '../../../shared/camera/camera.service';\nimport { DialogsService } from '../../../shared/dialogs/dialogs.service';\nimport { MomentRepository } from '../../../shared/moment/moment-repository.service';\nimport { concatTap, isNonNullable } from '../../../utils/rx-operators';\n\n@UntilDestroy()\n@Component({\n  selector: 'app-camera',\n  templateUrl: './camera.page.html',\n  styleUrls: ['./camera.page.scss'],\n})\nexport class CameraPage {\n  readonly videoDevices$ = this.cameraService.videoDevices$;\n\n  private readonly _videoElement$ = new BehaviorSubject<\n    HTMLVideoElement | undefined\n  >(undefined);\n\n  private readonly videoElement$ = this._videoElement$.pipe(\n    isNonNullable(),\n    distinctUntilChanged()\n  );\n\n  @ViewChild('video')\n  set videoElement(value: ElementRef<HTMLVideoElement> | undefined) {\n    if (value) this._videoElement$.next(value.nativeElement);\n  }\n\n  readonly capturedImageUrl$ = this.cameraService.capturedImageUrl$;\n\n  constructor(\n    private readonly dialogsService: DialogsService,\n    private readonly momentRepository: MomentRepository,\n    private readonly cameraService: CameraService\n  ) {\n    this.startPreview();\n  }\n\n  private startPreview() {\n    return this.videoElement$\n      .pipe(\n        concatMap(videoElement =>\n          this.cameraService.connectPreview$(videoElement)\n        ),\n        catchError(async (err: unknown) =>\n          this.dialogsService.presentError(err)\n        ),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n\n  capture() {\n    this.cameraService\n      .capture$()\n      .pipe(\n        concatTap(imageBlob => this.momentRepository.add$(imageBlob)),\n        catchError(async (err: unknown) =>\n          this.dialogsService.presentError(err)\n        ),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n\n  reverseCamera() {\n    return this.videoElement$\n      .pipe(\n        concatMap(videoElement =>\n          this.cameraService.reverseCamera$(videoElement)\n        ),\n        untilDestroyed(this)\n      )\n      .subscribe();\n  }\n}\n","<ion-button routerLink=\"..\" routerDirection=\"back\" class=\"dismiss\" fill=\"clear\">\n  <ion-icon slot=\"icon-only\" name=\"close-outline\" color=\"light\"></ion-icon>\n</ion-button>\n<ng-container *ngIf=\"(videoDevices$ | ngrxPush)?.length !== 0; else noCamera\">\n  <ion-button (click)=\"capture()\" class=\"capture\" fill=\"clear\">\n    <ion-icon\n      slot=\"icon-only\"\n      name=\"radio-button-on-outline\"\n      color=\"light\"\n    ></ion-icon>\n  </ion-button>\n  <ion-button\n    *ngIf=\"true\"\n    (click)=\"reverseCamera()\"\n    class=\"capture\"\n    class=\"reverse-camera\"\n    fill=\"clear\"\n  >\n    <ion-icon\n      slot=\"icon-only\"\n      name=\"camera-reverse-outline\"\n      color=\"light\"\n    ></ion-icon>\n  </ion-button>\n  <div\n    *ngrxLet=\"capturedImageUrl$ as capturedImageUrl\"\n    class=\"captured ion-margin\"\n  >\n    <app-image [src]=\"capturedImageUrl\"></app-image>\n  </div>\n  <video #video playsinline autoplay></video>\n</ng-container>\n<ng-template #noCamera>\n  <div class=\"no-camera\">\n    <div *transloco=\"let t\" class=\"no-camera-illustration\">\n      <ion-img src=\"./assets/icons/undraw-void.svg\"></ion-img>\n      <h3>{{ t('noCameraFound') }}</h3>\n      <p>{{ t('message.noCameraFound') }}</p>\n    </div>\n  </div>\n</ng-template>\n","/* eslint-disable no-console */\nimport { Injectable } from '@angular/core';\nimport { BehaviorSubject, defer, iif, Observable, ReplaySubject } from 'rxjs';\nimport {\n  catchError,\n  concatMapTo,\n  distinctUntilChanged,\n  first,\n  map,\n  mapTo,\n  pairwise,\n  shareReplay,\n  startWith,\n  switchMap,\n  tap,\n} from 'rxjs/operators';\nimport {\n  concatTap,\n  finalizeLast,\n  isNonNullable,\n} from '../../utils/rx-operators';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class CameraService {\n  readonly videoDevices$ = defer(() =>\n    navigator.mediaDevices.enumerateDevices()\n  ).pipe(\n    map(devices => devices.filter(d => d.kind === 'videoinput')),\n    shareReplay({ bufferSize: 1, refCount: true })\n  );\n\n  private readonly _mediaStream$ = new ReplaySubject<MediaStream>(1);\n\n  private readonly t = this._mediaStream$\n    .pipe(tap(v => console.log('next', v)))\n    .subscribe();\n\n  private readonly mediaStream$ = defer(() => getEnvironmentCamera()).pipe(\n    tap(v => console.log('init', v)),\n    tap(mediaStream => this._mediaStream$.next(mediaStream)),\n    concatMapTo(this._mediaStream$),\n    shareReplay({ bufferSize: 1, refCount: true }),\n    tap(v => console.log('here', v)),\n    isNonNullable(),\n    finalizeLast(mediaStream => {\n      if (mediaStream) stopMediaStream(mediaStream);\n    }),\n    shareReplay({ bufferSize: 1, refCount: true })\n  );\n\n  private readonly imageCapture$ = this.mediaStream$.pipe(\n    map(mediaStream => mediaStream.getVideoTracks()[0]),\n    isNonNullable(),\n    map(track => new ImageCapture(track)),\n    shareReplay({ bufferSize: 1, refCount: true })\n  );\n\n  private readonly _capturedImageUrl$ = new BehaviorSubject<string | undefined>(\n    undefined\n  );\n\n  readonly capturedImageUrl$ = this._capturedImageUrl$.pipe(\n    isNonNullable(),\n    distinctUntilChanged(),\n    revokePreviousImageUrl()\n  );\n\n  connectPreview$(videoElement: HTMLVideoElement) {\n    return this.mediaStream$.pipe(\n      tap(v => console.log('preview', v)),\n      tap(mediaStream => (videoElement.srcObject = mediaStream)),\n      mapTo(videoElement)\n    );\n  }\n\n  capture$() {\n    return this.imageCapture$.pipe(\n      first(),\n      switchMap(imageCapture => imageCapture.takePhoto()),\n      tap(imageBlob => {\n        this._capturedImageUrl$.next(URL.createObjectURL(imageBlob));\n      }),\n      catchError(async (err: unknown) => {\n        if (\n          err instanceof DOMException &&\n          (err.name === 'InvalidStateError' ||\n            err.name === 'UnknownError' ||\n            err.name === 'OperationError')\n        ) {\n          return undefined;\n        }\n        throw err;\n      }),\n      isNonNullable()\n    );\n  }\n\n  reverseCamera$(videoElement: HTMLVideoElement) {\n    return this.mediaStream$.pipe(\n      first(),\n      map(mediaStream => {\n        const tracks = mediaStream.getVideoTracks();\n        if (tracks.length === 0) return;\n        const facingMode = tracks[0].getConstraints().facingMode;\n        if (facingMode === undefined) return;\n        videoElement.srcObject = null;\n        stopMediaStream(mediaStream);\n        return facingMode;\n      }),\n      isNonNullable(),\n      concatTap(facingMode =>\n        iif(\n          () => facingMode === 'environment',\n          defer(async () => {\n            console.log('b', facingMode);\n            this._mediaStream$.next(await getUserCamera());\n            console.log('a', facingMode);\n          }),\n          defer(async () => {\n            console.log('b', facingMode);\n            this._mediaStream$.next(await getEnvironmentCamera());\n            console.log('a', facingMode);\n          })\n        )\n      ),\n      tap(() => console.log('afterPushNext', videoElement)),\n      catchError(async (err: unknown) => {\n        const e = err as any;\n        console.error(e.name, e);\n      })\n    );\n  }\n}\n\nfunction revokePreviousImageUrl() {\n  return (source$: Observable<string>) =>\n    source$.pipe(\n      startWith(undefined),\n      pairwise(),\n      tap(([previous]) => {\n        if (previous) URL.revokeObjectURL(previous);\n      }),\n      concatMapTo(source$)\n    );\n}\n\nfunction stopMediaStream(mediaStream: MediaStream) {\n  mediaStream.getVideoTracks().forEach(t => t.stop());\n  return mediaStream;\n}\n\nasync function getEnvironmentCamera() {\n  return navigator.mediaDevices.getUserMedia({\n    video: { facingMode: 'environment' },\n  });\n}\n\nasync function getUserCamera() {\n  return navigator.mediaDevices.getUserMedia({\n    video: { facingMode: 'user' },\n  });\n}\n","import { Injectable } from '@angular/core';\nimport { AlertController } from '@ionic/angular';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class DialogsService {\n  constructor(private readonly alertController: AlertController) {}\n\n  async presentError(error: unknown) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n    const alert = await this.alertController.create({\n      header: error instanceof Error ? error.name : 'Unknown Error',\n      message: error instanceof Error ? error.message : JSON.stringify(error),\n      buttons: [{ text: 'ok' }],\n    });\n    await alert.present();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { NgxIonicImageViewerModule } from 'ngx-ionic-image-viewer';\nimport { SharedModule } from '../../../shared/shared.module';\nimport { CameraPageRoutingModule } from './camera-routing.module';\nimport { CameraPage } from './camera.page';\n\n@NgModule({\n  imports: [SharedModule, CameraPageRoutingModule, NgxIonicImageViewerModule],\n  declarations: [CameraPage],\n})\nexport class CameraPageModule {}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { CameraPage } from './camera.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: CameraPage,\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class CameraPageRoutingModule {}\n"],"sourceRoot":"webpack:///"}