(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{QDOj:function(e,t,i){"use strict";i.r(t),i.d(t,"CameraPageModule",function(){return F});var n=i("6g0+"),r=i("PCNd"),c=i("tyNb"),o=i("mrSG"),a=i("VfN6"),s=i("2Vo4"),b=i("/uUt"),d=i("bOdf"),l=i("JIr8"),u=i("KJy6"),p=i("fXoL"),h=i("TEn/");let v=(()=>{class e{constructor(e){this.alertController=e}presentError(e){return Object(o.a)(this,void 0,void 0,function*(){console.error(e);const t=yield this.alertController.create({header:e instanceof Error?e.name:"Unknown Error",message:e instanceof Error?e.message:JSON.stringify(e),buttons:[{text:"ok"}]});yield t.present()})}}return e.\u0275fac=function(t){return new(t||e)(p.Wb(h.a))},e.\u0275prov=p.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var m=i("BJdS"),g=i("r0o6"),O=i("NXyV"),f=i("jtHE"),j=i("lJxs"),C=i("UXun"),x=i("vkgz"),$=i("CqXF"),w=i("SxV6"),S=i("eIep"),P=i("q7zd"),_=i("JX91"),k=i("7o/Q");class E{call(e,t){return t.subscribe(new I(e))}}class I extends k.a{constructor(e){super(e),this.hasPrev=!1}_next(e){let t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}let M=(()=>{class e{constructor(){this.videoStreamSelector=new y,this.videoDevices$=this.videoStreamSelector.devices$,this.mediaStream$=this.videoStreamSelector.stream$,this.imageCapture$=this.mediaStream$.pipe(Object(j.a)(e=>e.getVideoTracks()[0]),Object(u.c)(),Object(j.a)(e=>new ImageCapture(e)),Object(C.a)({bufferSize:1,refCount:!0})),this._capturedImageUrl$=new s.a(void 0),this.capturedImageUrl$=this._capturedImageUrl$.pipe(Object(u.c)(),Object(b.a)(),e=>e.pipe(Object(_.a)(void 0),e=>e.lift(new E),Object(x.a)(([e])=>{e&&URL.revokeObjectURL(e)}),Object(P.a)(e)))}connectPreview$(e){return this.mediaStream$.pipe(Object(x.a)(t=>e.srcObject=t),Object($.a)(e))}capture$(){return this.imageCapture$.pipe(Object(w.a)(),Object(S.a)(e=>e.takePhoto()),Object(x.a)(e=>{this._capturedImageUrl$.next(URL.createObjectURL(e))}),Object(l.a)(e=>Object(o.a)(this,void 0,void 0,function*(){if(!(e instanceof DOMException)||"InvalidStateError"!==e.name&&"UnknownError"!==e.name&&"OperationError"!==e.name)throw e})),Object(u.c)())}nextCamera$(e){return this.videoDevices$.pipe(Object(w.a)(),Object(d.a)(t=>Object(g.a)(()=>t.length>1,Object(O.a)(()=>Object(o.a)(this,void 0,void 0,function*(){return e.srcObject=null})).pipe(Object(P.a)(this.videoStreamSelector.next$())))))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=p.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class y{constructor(){this.devices$=Object(O.a)(()=>navigator.mediaDevices.enumerateDevices()).pipe(Object(j.a)(e=>e.filter(e=>"videoinput"===e.kind)),Object(C.a)({bufferSize:1,refCount:!0})),this.currentVideoDeviceIndex=0,this._stream$=new f.a(1),this.stream$=this.devices$.pipe(Object(w.a)(),Object(d.a)(e=>this.getCurrentVideoMedia(e)),Object(x.a)(e=>this._stream$.next(e)),Object(P.a)(this._stream$),Object(C.a)({bufferSize:1,refCount:!0}),Object(u.c)(),Object(u.b)(e=>function(e){return e.getVideoTracks().forEach(e=>e.stop()),e}(e)),Object(C.a)({bufferSize:1,refCount:!0}))}next$(){return this.stream$.pipe(Object(w.a)(),Object(x.a)(e=>e.getVideoTracks().forEach(e=>e.stop())),Object(P.a)(this.devices$),Object(x.a)(()=>this.currentVideoDeviceIndex++),Object(d.a)(e=>this.getCurrentVideoMedia(e)),Object(x.a)(e=>this._stream$.next(e)))}getCurrentVideoMedia(e){return Object(o.a)(this,void 0,void 0,function*(){return navigator.mediaDevices.getUserMedia({video:{deviceId:e[this.currentVideoDeviceIndex%e.length].deviceId}})})}}var U=i("ofXK"),D=i("9A8T"),R=i("/T4s"),V=i("QPBi");const J=["video"];function L(e,t){if(1&e){const e=p.Tb();p.Sb(0,"ion-button",10),p.ac("click",function(){return p.nc(e),p.cc(2).reverseCamera()}),p.Ob(1,"ion-icon",11),p.Rb()}}function z(e,t){if(1&e&&(p.Sb(0,"div",12),p.Ob(1,"app-image",13),p.Rb()),2&e){const e=t.ngrxLet;p.Cb(1),p.ic("src",e)}}function N(e,t){if(1&e){const e=p.Tb();p.Qb(0),p.Sb(1,"ion-button",4),p.ac("click",function(){return p.nc(e),p.cc().capture()}),p.Ob(2,"ion-icon",5),p.Rb(),p.tc(3,L,2,0,"ion-button",6),p.dc(4,"ngrxPush"),p.tc(5,z,2,1,"div",7),p.Ob(6,"video",8,9),p.Pb()}if(2&e){const e=p.cc();let t=null;p.Cb(3),p.ic("ngIf",(null==(t=p.ec(4,2,e.videoDevices$))?null:t.length)>1),p.Cb(2),p.ic("ngrxLet",e.capturedImageUrl$)}}function T(e,t){if(1&e&&(p.Sb(0,"div",16),p.Ob(1,"ion-img",17),p.Sb(2,"h3"),p.vc(3),p.Rb(),p.Sb(4,"p"),p.vc(5),p.Rb(),p.Rb()),2&e){const e=t.$implicit;p.Cb(3),p.wc(e("noCameraFound")),p.Cb(2),p.wc(e("message.noCameraFound"))}}function X(e,t){1&e&&(p.Sb(0,"div",14),p.tc(1,T,6,2,"div",15),p.Rb())}const Q=[{path:"",component:(()=>{let e=class{constructor(e,t,i){this.dialogsService=e,this.momentRepository=t,this.cameraService=i,this.videoDevices$=this.cameraService.videoDevices$,this._videoElement$=new s.a(void 0),this.videoElement$=this._videoElement$.pipe(Object(u.c)(),Object(b.a)()),this.capturedImageUrl$=this.cameraService.capturedImageUrl$,this.startPreview()}set videoElement(e){e&&this._videoElement$.next(e.nativeElement)}startPreview(){return this.videoElement$.pipe(Object(d.a)(e=>this.cameraService.connectPreview$(e)),Object(l.a)(e=>Object(o.a)(this,void 0,void 0,function*(){return this.dialogsService.presentError(e)})),Object(a.b)(this)).subscribe()}capture(){this.cameraService.capture$().pipe(Object(u.a)(e=>this.momentRepository.add$(e)),Object(l.a)(e=>Object(o.a)(this,void 0,void 0,function*(){return this.dialogsService.presentError(e)})),Object(a.b)(this)).subscribe()}reverseCamera(){return this.videoElement$.pipe(Object(d.a)(e=>this.cameraService.nextCamera$(e)),Object(a.b)(this)).subscribe()}};return e.\u0275fac=function(t){return new(t||e)(p.Nb(v),p.Nb(m.a),p.Nb(M))},e.\u0275cmp=p.Hb({type:e,selectors:[["app-camera"]],viewQuery:function(e,t){if(1&e&&p.Ac(J,1),2&e){let e;p.lc(e=p.bc())&&(t.videoElement=e.first)}},decls:6,vars:4,consts:[["routerLink","..","routerDirection","back","fill","clear",1,"dismiss"],["slot","icon-only","name","close-outline","color","light"],[4,"ngIf","ngIfElse"],["noCamera",""],["fill","clear",1,"capture",3,"click"],["slot","icon-only","name","radio-button-on-outline","color","light"],["class","capture","class","reverse-camera","fill","clear",3,"click",4,"ngIf"],["class","captured ion-margin",4,"ngrxLet"],["playsinline","","autoplay",""],["video",""],["fill","clear",1,"reverse-camera",3,"click"],["slot","icon-only","name","camera-reverse-outline","color","light"],[1,"captured","ion-margin"],[3,"src"],[1,"no-camera"],["class","no-camera-illustration",4,"transloco"],[1,"no-camera-illustration"],["src","./assets/icons/undraw-void.svg"]],template:function(e,t){if(1&e&&(p.Sb(0,"ion-button",0),p.Ob(1,"ion-icon",1),p.Rb(),p.tc(2,N,8,4,"ng-container",2),p.dc(3,"ngrxPush"),p.tc(4,X,2,0,"ng-template",null,3,p.uc)),2&e){const e=p.mc(5);let i=null;p.Cb(2),p.ic("ngIf",0!==(null==(i=p.ec(3,2,t.videoDevices$))?null:i.length))("ngIfElse",e)}},directives:[h.e,h.J,c.h,h.o,U.l,D.a,R.a,V.c,h.p],pipes:[D.b],styles:["[_nghost-%COMP%]{display:contents;position:relative}video[_ngcontent-%COMP%]{width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center}ion-button.dismiss[_ngcontent-%COMP%]{right:0;width:48px;height:48px;--background:rgba(0,0,0,0.13333333333333333)}ion-button.capture[_ngcontent-%COMP%], ion-button.dismiss[_ngcontent-%COMP%]{position:absolute;z-index:1;--border-radius:50%;--padding-end:0;--padding-start:0}ion-button.capture[_ngcontent-%COMP%]{bottom:0;left:50%;transform:translate(-50%);height:72px;width:72px;margin:0 0 var(--ion-margin,16px);--background:rgba(0,0,0,0.4)}ion-button.capture[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px}ion-button.reverse-camera[_ngcontent-%COMP%]{position:absolute;bottom:16px;left:16px;z-index:1;height:48px;width:48px;--border-radius:50%;--padding-end:0;--padding-start:0;--background:rgba(0,0,0,0.4)}.captured[_ngcontent-%COMP%]{position:absolute;bottom:16px;right:16px;overflow:hidden;border-radius:4px;border:1px solid var(--ion-color-light-shade)}.captured[_ngcontent-%COMP%]   app-image[_ngcontent-%COMP%]{z-index:1;width:60px;height:60px}.no-camera[_ngcontent-%COMP%]{width:100%;height:100%;background:var(--ion-color-light-shade)}.no-camera-illustration[_ngcontent-%COMP%]{width:70%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}.no-camera-illustration[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{margin:auto;max-width:400px}.no-camera-illustration[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{white-space:pre-line}"]}),e=Object(o.b)([Object(a.a)()],e),e})()}];let K=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.Lb({type:e}),e.\u0275inj=p.Kb({imports:[[c.i.forChild(Q)],c.i]}),e})(),F=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.Lb({type:e}),e.\u0275inj=p.Kb({imports:[[r.a,K,n.a]]}),e})()}}]);